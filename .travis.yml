os: linux
dist: xenial
language: python
cache: pip

env:
  global:
    - PYTHONFAULTHANDLER=x
    - SKIP_LATEX_BUILD=1
    - IS_PYTHON=true

jobs:
  include:
    - python: '3.6'
      env:
        - TOXENV=du14
    - python: '3.7'
      env:
        - TOXENV=du15
    - python: '3.8'
      env:
        - TOXENV=du16
        - PYTEST_ADDOPTS="--cov ./ --cov-append --cov-config setup.cfg"
    - python: '3.9-dev'
      env:
        - TOXENV=py39
    - python: 'nightly'
      env:
        - TOXENV=py310

    - language: node_js
      node_js: '10.7'
      env: IS_PYTHON=false
      services: xvfb

install:
  - "sudo apt-get install graphviz"
  - ( cd /opt && curl -sL https://github.com/jgm/pandoc/releases/download/2.1.2/pandoc-2.1.2-linux.tar.gz | tar -xzv --strip-components=1 pandoc-2.1.2/bin )
  - if [ $IS_PYTHON = true ]; then pip install -U tox codecov; fi
  - if [ $IS_PYTHON = false ]; then npm install; fi

before_script:
  - export PATH="/opt/bin:$PATH"

script:
  - if [ $IS_PYTHON = true ]; then tox -- -vv; fi
  - if [ $IS_PYTHON = false ]; then npm test; fi

after_success:
  - if [[ -e .coverage ]]; then codecov -e $TOXENV; fi
